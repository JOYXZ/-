<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é£Ÿå“å°åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* 1. å…¨å±€é”å®šï¼šä¸¥ç¦æ¨ªå‘æ»‘åŠ¨ */
        html, body { 
            max-width: 100%; 
            overflow-x: hidden; 
            background: #ffffff;
            font-family: -apple-system, "Helvetica Neue", Arial, sans-serif;
        }

        #chat::-webkit-scrollbar { display: none; }

        /* 2. æ–‡ç« æ’ç‰ˆå®¹å™¨ï¼šå¼ºåˆ¶å®½åº¦å¹¶å…è®¸è‡ªç„¶æ¢è¡Œ */
        .article-content {
            width: 100%;
            max-width: 100%;
            padding: 0 4px; /* ç»™å·¦å³ç•™ä¸€ç‚¹ç‚¹å‘¼å¸æ„Ÿ */
            word-wrap: break-word;
            word-break: break-all; /* é˜²æ­¢è¶…é•¿åŒ–å­¦åè¯æ’‘å¼€å±å¹• */
            line-height: 1.8;
            color: #333;
        }

        .article-content h1 { font-size: 1.5rem; font-weight: 800; margin: 20px 0 10px; color: #000; }
        .article-content h2 { font-size: 1.2rem; font-weight: 700; margin: 25px 0 10px; color: #2563eb; border-left: 4px solid #2563eb; padding-left: 10px; }
        .article-content p { margin-bottom: 15px; font-size: 16px; text-align: justify; }

        /* åˆ—è¡¨ä¼˜åŒ–ï¼šä¸å†åšæˆå¡ç‰‡ï¼Œè€Œæ˜¯çº¯æ–‡æœ¬åˆ—è¡¨ï¼ŒèŠ‚çœç©ºé—´ */
        .article-content ul, .article-content ol { padding-left: 20px; margin-bottom: 20px; }
        .article-content li { margin-bottom: 10px; list-style-type: disc; }

        /* é‡ç‚¹å¼•ç”¨çš„é‡‘å¥æ ·å¼ */
        .article-content blockquote {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-weight: 600;
            color: #1e40af;
        }

        .animate-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .glass-footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="px-6 py-6 border-b border-gray-100 shrink-0 bg-white">
        <h1 class="text-xl font-black">é£Ÿå“å°åŠ©æ‰‹</h1>
    </header>

    <main id="chat" class="flex-1 overflow-y-auto px-5 pt-4 pb-40">
        <div id="welcome" class="text-center py-20 opacity-30">
            <div class="text-5xl mb-4">ğŸ“–</div>
            <p>è¯·å‘é€ç…§ç‰‡ï¼Œå¼€å§‹æ·±åº¦åˆ†æ</p>
        </div>
    </main>

    <div id="preview-container" class="fixed bottom-32 left-6 hidden z-50">
        <div class="relative">
            <img id="preview" class="w-20 h-20 object-cover rounded-xl shadow-2xl">
            <button onclick="clearImage()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">âœ•</button>
        </div>
    </div>

    <footer class="fixed bottom-0 inset-x-0 glass-footer pb-8 pt-4 px-6 z-40">
        <div class="max-w-3xl mx-auto flex items-center gap-3">
            <label class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform cursor-pointer">
                <span class="text-xl text-white">ğŸ“¸</span>
                <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFile()">
            </label>
            <div class="flex-1 bg-gray-100 rounded-full px-5 h-12 flex items-center border border-transparent focus-within:bg-white focus-within:border-blue-500 transition-all">
                <input id="userInput" type="text" class="w-full bg-transparent outline-none text-[16px]" placeholder="æƒ³äº†è§£ä»€ä¹ˆï¼Ÿ">
                <button onclick="sendMessage()" class="ml-2 text-blue-600 font-bold">å‘é€</button>
            </div>
        </div>
    </footer>

    <script>
        const API_KEY = 'sk-6f30d07d56ad422ab4f9c515c3e19aff'; 
        const API_URL = 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions';
        let currentBase64 = "";

        function handleFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onloadend = () => {
                currentBase64 = reader.result.split(',')[1];
                document.getElementById('preview').src = reader.result;
                document.getElementById('preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            currentBase64 = "";
            document.getElementById('preview-container').classList.add('hidden');
            document.getElementById('fileInput').value = "";
        }

        function appendMessage(role, content) {
            document.getElementById('welcome')?.remove();
            const chat = document.getElementById('chat');
            const wrapper = document.createElement('div');
            
            if (role === 'user') {
                wrapper.className = "flex justify-end mb-8";
                wrapper.innerHTML = `<div class="bg-gray-800 text-white px-4 py-2 rounded-2xl text-sm">${content}</div>`;
            } else {
                // Bot å›å¤ä½¿ç”¨æ–‡ç« æµæ¨¡å¼
                wrapper.className = "article-content animate-up mb-12";
                wrapper.innerHTML = marked.parse(content);
            }
            
            chat.appendChild(wrapper);
            chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
            return wrapper;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text && !currentBase64) return;

            appendMessage('user', text || "ğŸ“· æ­£åœ¨ä¸ºæ‚¨æ’°å†™åˆ†ææ–‡ç« ...");
            const content = [{ type: "text", text: text || "è¯·åˆ†æè¿™å¼ å›¾ç‰‡ã€‚" }];
            if (currentBase64) content.push({ type: "image_url", image_url: { url: `data:image/jpeg;base64,${currentBase64}` } });

            input.value = "";
            clearImage();

            const loading = appendMessage('bot', `<p class="text-blue-500 italic">æ­£åœ¨ç”Ÿæˆæ·±åº¦å¥åº·è§£è¯»...</p>`);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "qwen-vl-plus",
                        messages: [
                            { 
                                role: "system", 
                                content: "ä½ æ˜¯ä¸€ä½èµ„æ·±è¥å…»ä¸“å®¶ã€‚è¯·ä¸ºç”¨æˆ·æ’°å†™ä¸€ç¯‡é€»è¾‘æ¸…æ™°ã€æ¨ªå‘ä¹¦å†™çš„åˆ†ææŠ¥å‘Šã€‚ç¦æ­¢ä½¿ç”¨ä»»ä½•è¡¨æ ¼ï¼Œæ–‡å­—å¿…é¡»åƒæ™®é€šæ–‡ç« æ®µè½ä¸€æ ·ä»å·¦å‘å³æ¨ªå‘ä¹¦å†™ã€‚ä¸¥ç¦æåŠä¿è´¨æœŸã€äº§åœ°ç­‰éè¥å…»ä¿¡æ¯ã€‚ç»“å°¾ç»™å‡ºä¸€ä¸ª10åˆ†åˆ¶çš„æ€»è¯„åˆ†
                                    
                                    è¦æ±‚ï¼š
1. **æ–‡ç« ç»“æ„**ï¼šæˆåˆ†åˆ†æï¼Œå¥åº·ç¨‹åº¦è¯„ä¼°ã€æ·±åº¦è¥å…»ç‚¹è¯„ã€ä¼˜ç¼ºç‚¹å¯¹æ¯”ã€ä»¥åŠé£Ÿç”¨å»ºè®®ã€‚
2. **ä¸¥ç¦è¡¨æ ¼**ï¼šæ–‡å­—å¿…é¡»åƒæ–‡ç« ä¸€æ ·è‡ªç„¶æµåŠ¨ï¼Œä»å·¦å‘å³æ¨ªå‘ä¹¦å†™ã€‚
3. **å†…å®¹èšç„¦**ï¼šæ·±åº¦è§£æè¥å…»æˆåˆ†ï¼Œä¸¥ç¦æåŠä¿è´¨æœŸã€äº§åœ°ç­‰éè¥å…»æ‚è®¯ã€‚
4. **è§†è§‰å‹å¥½**ï¼šä½¿ç”¨ Markdown æ ‡é¢˜ã€åˆ†æ®µã€åˆ—è¡¨å’Œå¼•ç”¨ï¼Œå¤šä½¿ç”¨ emoji å¢åŠ äº²å’ŒåŠ›ã€‚
5. **æ‰“åˆ†æ€»ç»“**ï¼šåœ¨æ–‡ç« ç»“å°¾ç»™å‡º 10 åˆ†åˆ¶çš„å¥åº·æŒ‡æ•°ã€‚`ã€‚" 
                            },
                            { role: "user", content: content }
                        ]
                    })
                });
                const data = await response.json();
                loading.innerHTML = marked.parse(data.choices[0].message.content);
            } catch (e) {
                loading.innerHTML = "ç½‘ç»œæš‚æ—¶æ— æ³•è¿æ¥ã€‚";
            }
        }
    </script>
</body>
</html>
