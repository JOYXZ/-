<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Health Insight AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { 
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif; 
            background: #ffffff; 
            color: #1a202c;
            -webkit-font-smoothing: antialiased;
        }
        #chat::-webkit-scrollbar { display: none; }
        
        /* æ–‡ç« é£æ ¼æ’ç‰ˆ */
        .article-style {
            line-height: 1.8;
            letter-spacing: 0.02em;
            word-break: normal; /* å…³é”®ï¼šæ­£å¸¸æŠ˜è¡Œ */
            white-space: normal; /* å…³é”®ï¼šæ–‡å­—æ¨ªå‘æ’åˆ— */
        }

        .article-style h1 { 
            font-size: 1.6rem; font-weight: 800; color: #111827; 
            margin: 24px 0 12px 0; line-height: 1.3; 
        }
        
        .article-style h2 { 
            font-size: 1.2rem; font-weight: 700; color: #2563eb; 
            margin: 30px 0 12px 0; padding-bottom: 8px; border-bottom: 1px solid #f3f4f6;
        }

        .article-style p { margin-bottom: 16px; text-align: justify; }

        /* é‡ç‚¹æ®µè½å¼ºè°ƒ */
        .article-style blockquote {
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-style: normal;
            color: #475569;
        }

        .article-style strong { color: #111827; font-weight: 600; background: linear-gradient(180deg,transparent 70%,#dbeafe 0); }

        /* åˆ—è¡¨æ”¹ä¸ºæ— æ¡†å¼ï¼Œä¿è¯æ¨ªå‘ç©ºé—´ */
        .article-style ul { padding-left: 0; margin-bottom: 20px; }
        .article-style li { 
            position: relative; padding-left: 1.5rem; margin-bottom: 8px; 
            list-style: none;
        }
        .article-style li::before {
            content: "â€¢"; color: #3b82f6; font-weight: bold;
            position: absolute; left: 0;
        }

        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .glass-footer { background: rgba(255, 255, 255, 0.98); border-top: 1px solid #f1f5f9; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="px-6 py-6 shrink-0 border-b border-gray-50 bg-white z-50">
        <h1 class="text-xl font-black text-gray-900 tracking-tight">Health Insight <span class="text-blue-600">.</span></h1>
    </header>

    <main id="chat" class="flex-1 overflow-y-auto px-6 pt-4 pb-40">
        <div id="welcome" class="py-10 text-center">
            <div class="text-4xl mb-4">ğŸ“–</div>
            <p class="text-gray-400 text-sm">ä¸Šä¼ å›¾ç‰‡ï¼Œä¸ºæ‚¨æ’°å†™æ·±åº¦çš„è¥å…»åˆ†ææ–‡ç« </p>
        </div>
    </main>

    <div id="preview-container" class="fixed bottom-32 left-6 hidden z-50">
        <div class="relative">
            <img id="preview" class="w-20 h-20 object-cover rounded-lg shadow-2xl border border-gray-100">
            <button onclick="clearImage()" class="absolute -top-2 -right-2 bg-black text-white rounded-full w-6 h-6 text-xs flex items-center justify-center">âœ•</button>
        </div>
    </div>

    <footer class="fixed bottom-0 inset-x-0 glass-footer pb-8 pt-4 px-6 z-40">
        <div class="max-w-3xl mx-auto flex items-center gap-3">
            <label class="shrink-0 w-12 h-12 bg-gray-900 rounded-full flex items-center justify-center cursor-pointer active:scale-90 transition-transform shadow-lg">
                <span class="text-xl text-white">ğŸ“¸</span>
                <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFile()">
            </label>
            <div class="flex-1 bg-gray-50 rounded-full px-5 h-12 flex items-center border border-gray-200 focus-within:bg-white focus-within:border-blue-400 transition-all">
                <input id="userInput" type="text" class="w-full bg-transparent outline-none text-[16px]" placeholder="åœ¨æ­¤æé—®...">
                <button onclick="sendMessage()" class="ml-2 text-blue-600 font-bold">å‘å¸ƒ</button>
            </div>
        </div>
    </footer>

    <script>
        const API_KEY = 'sk-6f30d07d56ad422ab4f9c515c3e19aff'; 
        const API_URL = 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions';
        let currentBase64 = "";

        function handleFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onloadend = () => {
                currentBase64 = reader.result.split(',')[1];
                document.getElementById('preview').src = reader.result;
                document.getElementById('preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            currentBase64 = "";
            document.getElementById('preview-container').classList.add('hidden');
            document.getElementById('fileInput').value = "";
        }

        function appendMessage(role, content) {
            document.getElementById('welcome')?.remove();
            const chat = document.getElementById('chat');
            const wrapper = document.createElement('div');
            wrapper.className = `mb-10 ${role === 'user' ? 'flex justify-end' : 'article-style animate-fade-in'}`;
            
            if (role === 'user') {
                wrapper.innerHTML = `<div class="bg-blue-600 text-white px-4 py-2 rounded-2xl text-sm shadow-sm">${content}</div>`;
            } else {
                wrapper.innerHTML = marked.parse(content);
            }
            
            chat.appendChild(wrapper);
            chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
            return wrapper;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text && !currentBase64) return;

            appendMessage('user', text || "å¼€å§‹åˆ†æé£Ÿå“è¥å…»æŠ¥å‘Š...");
            const content = [{ type: "text", text: text || "è¯·ä»¥ä¸“ä¸šå¥åº·æ–‡ç« çš„å½¢å¼åˆ†ææ­¤é£Ÿå“ã€‚" }];
            if (currentBase64) content.push({ type: "image_url", image_url: { url: `data:image/jpeg;base64,${currentBase64}` } });

            input.value = "";
            clearImage();

            const loading = appendMessage('bot', `<p class="text-blue-500 italic">æ­£åœ¨æ·±åº¦æ’°å†™å¥åº·æ´å¯Ÿæ–‡ç« ...</p>`);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "qwen-vl-plus",
                        messages: [
                            { 
                                role: "system", 
                                content: `ä½ æ˜¯ä¸€ä½çŸ¥åçš„å¥åº·æ‚å¿—ä¸»ç¼–å’Œé«˜çº§è¥å…»å¸ˆã€‚
è¯·é’ˆå¯¹ç”¨æˆ·æä¾›çš„é£Ÿå“ï¼Œæ’°å†™ä¸€ç¯‡æ’ç‰ˆç²¾ç¾ã€æ˜“äºé˜…è¯»çš„å¥åº·çŸ­æ–‡æŠ¥å‘Šã€‚

è¦æ±‚ï¼š
1. **æ–‡ç« ç»“æ„**ï¼šåŒ…å«æ–‡ç« å¤§æ ‡é¢˜ã€å‰è¨€ã€æ·±åº¦è¥å…»ç‚¹è¯„ã€ä¼˜ç¼ºç‚¹å¯¹æ¯”ã€ä»¥åŠæœ€ç»ˆçš„ä¸“å®¶å»ºè®®ã€‚
2. **ä¸¥ç¦è¡¨æ ¼**ï¼šæ–‡å­—å¿…é¡»åƒæ–‡ç« ä¸€æ ·è‡ªç„¶æµåŠ¨ï¼Œä»å·¦å‘å³æ¨ªå‘ä¹¦å†™ã€‚
3. **å†…å®¹èšç„¦**ï¼šæ·±åº¦è§£æè¥å…»æˆåˆ†ï¼Œä¸¥ç¦æåŠä¿è´¨æœŸã€äº§åœ°ç­‰éè¥å…»æ‚è®¯ã€‚
4. **è§†è§‰å‹å¥½**ï¼šä½¿ç”¨ Markdown æ ‡é¢˜ã€åˆ†æ®µã€åˆ—è¡¨å’Œå¼•ç”¨ï¼Œå¤šä½¿ç”¨ emoji å¢åŠ äº²å’ŒåŠ›ã€‚
5. **æ‰“åˆ†æ€»ç»“**ï¼šåœ¨æ–‡ç« ç»“å°¾ç»™å‡º 10 åˆ†åˆ¶çš„å¥åº·æŒ‡æ•°ã€‚` 
                            },
                            { role: "user", content: content }
                        ]
                    })
                });
                const data = await response.json();
                loading.innerHTML = marked.parse(data.choices[0].message.content);
            } catch (e) {
                loading.innerHTML = "æŠ±æ­‰ï¼Œç”±äºç½‘ç»œæ³¢åŠ¨ï¼Œæ–‡ç« æ’°å†™ä¸­æ–­äº†ã€‚";
            }
        }
    </script>
</body>
</html>
