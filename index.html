<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Health Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* å¼•å…¥æ›´æŸ”å’Œçš„å­—ä½“ */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: linear-gradient(135deg, #f8f9ff 0%, #e0e7ff 100%); }
        
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        #chat::-webkit-scrollbar { display: none; }
        
        /* åŒ»ç–—é£æ ¼å¡ç‰‡é˜´å½± */
        .medical-card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        /* æ¸å˜æ–‡æœ¬ */
        .text-gradient {
            background: linear-gradient(to right, #1e3a8a, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* æ°”æ³¡æ ·å¼å¾®è°ƒ */
        .bot-bubble { border-radius: 20px 20px 20px 4px; background: white; }
        .user-bubble { border-radius: 20px 20px 4px 20px; background: #2563eb; color: white; }

        /* åº•éƒ¨æ¯›ç»ç’ƒ */
        .glass-footer {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="px-6 pt-10 pb-4 shrink-0">
        <div class="flex justify-between items-center mb-2">
            <div>
                <p class="text-gray-500 text-sm">Good Day ğŸ‘‹</p>
                <h1 class="text-2xl font-bold text-gray-900">å¥åº·è¥å…»ç®¡å®¶</h1>
            </div>
            <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm border border-gray-100">
                <span class="text-xl">ğŸ””</span>
            </div>
        </div>
        <div class="bg-white/60 border border-gray-100 rounded-2xl p-3 flex items-center text-gray-400 text-sm medical-card">
            <span>ğŸ” è¯¢é—®ä»»ä½•è¥å…»æˆ–å¥åº·é—®é¢˜...</span>
        </div>
    </header>

    <main id="chat" class="flex-1 overflow-y-auto px-6 space-y-6 pb-24">
        <div class="flex flex-col items-center justify-center py-10 opacity-40">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-3xl mb-3">ğŸ¥¦</div>
            <p class="text-sm">ä¸Šä¼ æ ‡ç­¾ï¼Œå¼€å¯ä¸“ä¸šå¥åº·è¯„ä¼°</p>
        </div>
    </main>

    <div id="preview-container" class="fixed bottom-32 left-6 hidden z-50">
        <div class="relative">
            <img id="preview" class="w-24 h-24 object-cover rounded-2xl border-4 border-white shadow-xl">
            <button onclick="clearImage()" class="absolute -top-3 -right-3 bg-black text-white rounded-full w-7 h-7 flex items-center justify-center shadow-lg">âœ•</button>
        </div>
    </div>

    <footer class="fixed bottom-0 inset-x-0 glass-footer border-t border-white/20 pb-8 pt-4 px-6">
        <div class="max-w-xl mx-auto flex items-center gap-4">
            <label class="w-14 h-14 bg-black rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition-all cursor-pointer">
                <span class="text-2xl">ğŸ“·</span>
                <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFile()">
            </label>
            
            <div class="flex-1 bg-white border border-gray-100 rounded-2xl shadow-inner flex items-center px-4 h-14">
                <input id="userInput" type="text" 
                    class="w-full bg-transparent outline-none text-gray-700 placeholder-gray-400"
                    placeholder="è¾“å…¥é—®é¢˜...">
                <button onclick="sendMessage()" class="ml-2 text-blue-600 font-bold">å‘é€</button>
            </div>
        </div>
        
        <div class="w-32 h-1.5 bg-gray-200 mx-auto mt-6 rounded-full"></div>
    </footer>

    <script>
        // ä½ çš„é…ç½®
        const API_KEY = 'sk-6f30d07d56ad422ab4f9c515c3e19aff'; 
        const API_URL = 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions';
        let currentBase64 = "";

        // æ–‡ä»¶å¤„ç†
        function handleFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onloadend = () => {
                currentBase64 = reader.result.split(',')[1];
                document.getElementById('preview').src = reader.result;
                document.getElementById('preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            currentBase64 = "";
            document.getElementById('preview-container').classList.add('hidden');
            document.getElementById('fileInput').value = "";
        }

        // æ¸²æŸ“æ¶ˆæ¯
        function appendMessage(role, content) {
            const chat = document.getElementById('chat');
            const wrapper = document.createElement('div');
            wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`;
            
            const htmlContent = role === 'bot' ? marked.parse(content) : content;
            const style = role === 'user' ? 'user-bubble medical-card' : 'bot-bubble medical-card p-5 border border-gray-50';
            
            wrapper.innerHTML = `<div class="${style} px-5 py-3 max-w-[90%] text-[16px] leading-relaxed">${htmlContent}</div>`;
            chat.appendChild(wrapper);
            chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
            return wrapper;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text && !currentBase64) return;

            appendMessage('user', text || "æ­£åœ¨åˆ†ææ ‡ç­¾...");
            
            const content = [{ type: "text", text: text || "è¯·æŒ‰ç…§è¥å…»å¸ˆæŒ‡ä»¤åˆ†ææ­¤æ ‡ç­¾ã€‚" }];
            if (currentBase64) {
                content.push({ type: "image_url", image_url: { url: `data:image/jpeg;base64,${currentBase64}` } });
            }

            input.value = "";
            clearImage();

            const loading = appendMessage('bot', '<div class="flex space-x-2"><div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay:0.2s"></div><div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay:0.4s"></div></div>');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "qwen-vl-plus",
                        messages: [
                            { role: "system", content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è¥å…»å¸ˆã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œä»»åŠ¡ï¼š1.åˆ†æè¥å…»æˆåˆ† 2.è¯†åˆ«ç…§ç‰‡æ ‡ç­¾ 3.æ·±åº¦åˆ†ææ•°æ® 4.è¯´æ˜å¥åº·ç¨‹åº¦ 5.åˆ—ä¸¾ä¼˜ç¼ºç‚¹ 6.ç»¼åˆæ‰“åˆ†ã€‚è¯·ç”¨æ’ç‰ˆç²¾ç¾çš„ Markdown æ ¼å¼å›ç­”ã€‚" },
                            { role: "user", content: content }
                        ]
                    })
                });
                const data = await response.json();
                loading.innerHTML = `<div class="bot-bubble medical-card p-5 border border-gray-50 bg-white">${marked.parse(data.choices[0].message.content)}</div>`;
            } catch (e) {
                loading.innerHTML = "ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
            }
        }
    </script>
</body>
</html>
